<h3>{{ header }}</h3>
<ngx-spinner
  bdColor="rgba(0, 0, 0, 0.8)"
  size="medium"
  color="#fff"
  type="ball-scale-multiple"
  [fullScreen]="true"
  [show]="isLoading"
></ngx-spinner>

<div class="dashboard-container">
  <!-- top buttons -->
  <span class="buttons-container">
    <button
      (click)="changeActiveTab('dashboard'); loadSelectedTabData()"
      [ngClass]="[activeTab === 'dashboard' ? 'active' : 'inactive']"
    >
      Overview
    </button>
    <button
      (click)="changeActiveTab('insights')"
      [ngClass]="[activeTab === 'insights' ? 'active' : 'inactive']"
    >
      Insights
    </button>
  </span>

  <div class="row dropdowns col-12" *ngIf="activeTab === 'insights'">
    <div class="col-12">
      <div class="grid col-12">
        <div class="col-12 md:col-4">
          <p-dropdown
            [options]="clientNames"
            [(ngModel)]="defaultSelectedClient"
            (onChange)="onInsightClientChange(defaultSelectedClient)"
            placeholder=""
          >
          </p-dropdown>
        </div>

        <div class="col-12 md:col-4">
          <p-dropdown
            [options]="userDropdownData"
            [(ngModel)]="selectedUsername"
            (onChange)="onUserChange()"
            optionLabel="value"
            optionValue="id"
            placeholder=""
          >
          </p-dropdown>
        </div>
      </div>

      <!-- {{ userData.screens }} -->
      <div *ngIf="userData" class="flow-graph mt-4 mb-4">
        <h5 class="text-left" [ngClass]="{ hide: !userData.screens }">
          User Journey Flow
        </h5>
        <div
          class="col-lg-12 col-md-12 col-sm-12 flow-gragh-container"
          [ngClass]="{ 'disable-class-screen': isScreenOverview === true }"
        >
          <ol>
            <ng-container>
              <li *ngFor="let screen of userData.screens | keyvalue">
                <span id="screenName">{{ screen.key }}</span>
                <ul class="clikedbutton">
                  <ng-container
                    *ngFor="let entry of getObjectEntries(screen.value)"
                  >
                    <div class="actions-list">
                      {{ entry[0] }}: {{ entry[1] }}
                    </div>
                  </ng-container>
                </ul>
              </li>
            </ng-container>
          </ol>
        </div>

        <div
          class="col-12 md:lg-12"
          [ngClass]="{ hide: !isChartDataAvailable }"
        >
          <div class="justify-content-between flex mb-2 text-left">
            <div>
              <label>Would you like to see user journey?</label>
              <div>
                <p-calendar
                  class="date-input field"
                  #datePicker
                  [(ngModel)]="selectedDate"
                  [showIcon]="true"
                  (onSelect)="onDateChange($event)"
                  id="icondisplay"
                  placeholder="Select Date"
                ></p-calendar>
              </div>
            </div>
            <div>
              <p-dropdown
                [options]="intervalOptions"
                [(ngModel)]="selectedInterval"
                (onChange)="onIntervalChange(selectedInterval)"
                optionLabel="label"
                optionValue="value"
              ></p-dropdown>
            </div>
          </div>
          <div class="high-chart" [ngClass]="{ hide: !isChartDataAvailable }">
            <div id="container"></div>
          </div>
        </div>

        <div class="no-data" *ngIf="!isChartDataAvailable">
          <h3 class="mt-8">No data found</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- 
dashboard -->
  <div *ngIf="activeTab == 'dashboard'" class="p-4">
    <div>
      <p-dropdown
        class="dashboard-dropdown"
        [options]="clientNames"
        [(ngModel)]="defaultSelectedClient"
        (onChange)="onDashboardChange(defaultSelectedClient)"
      >
      </p-dropdown>
    </div>

    <div class="cards-grid grid m-0">
      <div class="col-12 lg:col-6">
        <div class="card-widget">
          <p-card-header>
            <div class="card-header">
              <div class="header">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="icons"
                  width="45"
                  height="27.729"
                  viewBox="0 0 24.646 27.729"
                >
                  <path
                    id="Path_803"
                    d="M4,0H36a4,4,0,0,1,4,4V25a4,4,0,0,1-4,4H4a4,4,0,0,1-4-4V4A4,4,0,0,1,4,0Z"
                    fill="none"
                  />
                  <path
                    id="Path_801"
                    d="M33.713,18.075h0C32.47,15.515,27.6,7.167,16.983,7.167S1.5,15.515.253,18.075a2.488,2.488,0,0,0,0,2.187C1.5,22.819,6.369,31.168,16.983,31.168s15.487-8.348,16.73-10.908A2.487,2.487,0,0,0,33.713,18.075ZM16.983,28.5c-8.926,0-13.091-7.155-14.152-9.319,1.061-2.193,5.227-9.348,14.152-9.348,8.9,0,13.071,7.124,14.152,9.334C30.054,21.377,25.888,28.5,16.983,28.5Z"
                    transform="translate(0 -7.167)"
                    fill="#ebeef9"
                  />

                  <path
                    id="Path_802"
                    d="M23.8,16.722a6.881,6.881,0,0,0-7.076,6.667A6.881,6.881,0,0,0,23.8,30.056a6.881,6.881,0,0,0,7.076-6.667A6.889,6.889,0,0,0,23.8,16.722Zm0,10.667a4.128,4.128,0,0,1-4.246-4,4.128,4.128,0,0,1,4.246-4,4.128,4.128,0,0,1,4.246,4A4.128,4.128,0,0,1,23.8,27.389Z"
                    transform="translate(-6.816 -11.389)"
                    fill="#ebeef9"
                  />
                </svg>
              </div>

              <span class="icon-header">Most Viewed Pages</span>
            </div>
            <span class="menu-icon"
              ><a
                routerLink="/mostViewedPages"
                (click)="onMostViewedPagesClick()"
                ><img src="./../../../../assets/img/menu.svg" /></a
            ></span>
          </p-card-header>
          <div id="pie-chart-container"></div>
        </div>
      </div>

      <div class="col-12 lg:col-6">
        <div class="clicked-actions card-widget">
          <p-card-header>
            <div class="card-header">
              <div class="header">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="25.754"
                  height="30.919"
                  viewBox="0 0 24.646 27.729"
                >
                  <path
                    id="cursor-finger"
                    d="M22.584,12.079l-7.7-1.541V4A3.969,3.969,0,0,0,11.66.053,3.865,3.865,0,0,0,7.151,3.865v8.581L3.558,17.134a6.468,6.468,0,0,0,.321,8.752L6.97,29.01a6.488,6.488,0,0,0,4.578,1.908h9.773a6.449,6.449,0,0,0,6.441-6.441V18.395a6.458,6.458,0,0,0-5.179-6.316Zm2.6,12.4a3.865,3.865,0,0,1-3.865,3.865H11.549A3.893,3.893,0,0,1,8.8,27.194L5.708,24.066a3.9,3.9,0,0,1-.149-5.311l1.592-2.078V21.9a1.288,1.288,0,0,0,2.576,0V3.865A1.288,1.288,0,0,1,11.242,2.6,1.394,1.394,0,0,1,12.3,4v7.592a1.288,1.288,0,0,0,1.031,1.263L22.074,14.6a3.878,3.878,0,0,1,3.112,3.79Z"
                    transform="translate(-2.008 0.001)"
                    fill="#ebeef9"
                  />
                </svg>
              </div>

              <span class="icon-header">Most Clicked Actions </span>
            </div>
            <span class="menu-icon"><a routerLink="/mostClickedActions"
              (click)="onMostClickedActionsClick()"><img src="./../../../../assets/img/menu.svg"/></a></span
            >
          </p-card-header>
          <div id="bar-chart-container"></div>
        </div>
      </div>

      <div class="col-12 lg:col-6">
        <div class="active-user-by-device card-widget">
          <p-card-header>
            <div class="card-header">
              <div class="header">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24.646"
                  height="27.729"
                  viewBox="0 0 24.646 27.729"
                >
                  <path
                    id="user-check"
                    d="M9.87,14.8a7.4,7.4,0,1,0-7.4-7.4A7.41,7.41,0,0,0,9.87,14.8Zm0-12.337A4.935,4.935,0,1,1,4.935,7.4,4.94,4.94,0,0,1,9.87,2.467Zm9.87,24.674v1.234a1.234,1.234,0,0,1-2.467,0V27.142a7.4,7.4,0,0,0-14.8,0v1.234a1.234,1.234,0,0,1-2.467,0V27.142a9.87,9.87,0,0,1,19.74,0Zm9.5-14.537-4.925,4.781a3.866,3.866,0,0,1-5.453-.012l-2.432-2.287a1.234,1.234,0,1,1,1.693-1.8L20.576,15.6a1.414,1.414,0,0,0,2,.026l4.937-4.794a1.234,1.234,0,0,1,1.719,1.77Z"
                    fill="#ebeef9"
                  />
                </svg>
              </div>
              <span class="icon-header">Active User by Device</span>
            </div>
            <span class="menu-icon"
              ><a
              routerLink="/mostActiveUser"
              (click)="onActiveUserByDeviceClick()"
              ><img src="./../../../../assets/img/menu.svg"
            /></a></span
            >
          </p-card-header>
          <div id="pieChartContainer"></div>
          <div id="total-count" class="center-label"></div>
        </div>
      </div>

      <div class="col-12 lg:col-6">
        <div class="card-widget">
          <p-card-header>
            <div class="card-header">
              <div class="header">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="60.832"
                  height="60.832"
                  class="map-card"
                  viewBox="0 0 24.646 27.729"
                >
                  <path
                    id="globe"
                    d="M8.416,0a8.416,8.416,0,1,0,8.416,8.416A8.416,8.416,0,0,0,8.416,0ZM14.48,4.909H12.221a13.8,13.8,0,0,0-1.978-3.257A7.035,7.035,0,0,1,14.48,4.909ZM11.572,8.416a7.161,7.161,0,0,1-.334,2.1H5.594a7.161,7.161,0,0,1-.334-2.1,7.161,7.161,0,0,1,.334-2.1h5.644a7.161,7.161,0,0,1,.334,2.1ZM6.156,11.923h4.519a13.756,13.756,0,0,1-2.26,3.218,13.725,13.725,0,0,1-2.26-3.218Zm0-7.013a13.756,13.756,0,0,1,2.26-3.218,13.725,13.725,0,0,1,2.26,3.218Zm.436-3.257A13.8,13.8,0,0,0,4.611,4.909H2.352A7.035,7.035,0,0,1,6.593,1.652ZM1.726,6.312H4.138a8.427,8.427,0,0,0-.281,2.1,8.427,8.427,0,0,0,.281,2.1H1.726a7.008,7.008,0,0,1,0-4.208Zm.626,5.611H4.611A13.8,13.8,0,0,0,6.593,15.18,7.035,7.035,0,0,1,2.352,11.923Zm7.891,3.257a13.8,13.8,0,0,0,1.978-3.257H14.48A7.035,7.035,0,0,1,10.243,15.18Zm4.863-4.66H12.694a8.427,8.427,0,0,0,.281-2.1,8.427,8.427,0,0,0-.281-2.1H15.1a7.008,7.008,0,0,1,0,4.208Z"
                    fill="#ebeef9"
                  />
                </svg>
              </div>
              <span class="icon-header">Most Used Browsers</span>
            </div>
            <span class="menu-icon"
              ><a
              routerLink="/mostUsedBrowsers"
              (click)="onMostUsedBrowserClick()"
              ><img src="./../../../../assets/img/menu.svg"
            /></a></span>
          </p-card-header>
          <div
            id="most-used-browsers-chart-container"
            class="browser-view"
          ></div>
        </div>
      </div>

      <div
        class="col-12 lg:col-6"
        style="width: 100%"
        *ngIf="chartOptions !== null"
        [ngClass]="{ 'disable-class': ismapDisable === true }"
      >
        <div class="card-widget" size="large">
          <p-card-header>
            <div class="card-header">
              <div class="header">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="30.094"
                  height="50.832"
                  viewBox="0 0 14.094 16.832"
                >
                  <g
                    id="_01_align_center"
                    transform="translate(-35.955 -0.174)"
                  >
                    <path
                      id="Path_824"
                      data-name="Path 824"
                      d="M43,17.006l-.489-.419c-.674-.564-6.559-5.647-6.559-9.364a7.048,7.048,0,0,1,14.1,0c0,3.718-5.885,8.8-6.556,9.367ZM43,1.7a5.53,5.53,0,0,0-5.524,5.524C37.478,9.558,41.1,13.289,43,15c1.9-1.708,5.524-5.441,5.524-7.774A5.53,5.53,0,0,0,43,1.7Z"
                      transform="translate(0 0)"
                      fill="#ebeef9"
                    />
                    <path
                      id="Path_825"
                      data-name="Path 825"
                      d="M152.991,120a2.794,2.794,0,1,1,2.794-2.794A2.794,2.794,0,0,1,152.991,120Zm0-4.191a1.4,1.4,0,1,0,1.4,1.4A1.4,1.4,0,0,0,152.991,115.814Z"
                      transform="translate(-109.989 -109.989)"
                      fill="#ebeef9"
                    />
                  </g>
                </svg>
              </div>
              <span class="icon-header">Most Used Countries</span>
            </div>
            <span class="menu-icon"><a
              routerLink="/mostUsedCountries"
              (click)="onMostUsedCountriesClick()"
              ><img src="./../../../../assets/img/menu.svg"
            /></a></span>
          </p-card-header>
          <div class="grid">
            <div class="md:col-7 sm:col-12">
              <highcharts-chart
                id="map-chart-container"
                [Highcharts]="Highcharts"
                [constructorType]="chartConstructor"
                [options]="chartOptions"
              >
              </highcharts-chart>
            </div>

            <div class="md:col-5 sm:col-12">
              <div class="flex align-items-center h-full">
                <div class="chart-progress-bars">
                  <div class="progress-container">
                    <label>Countries</label>
                    <progress [max]="maxValue" value="0"></progress>
                    <span class="progress-value">Users</span>
                  </div>
                  <!-- Rest of the Progress Bars -->
                  <div
                    *ngFor="let progressBar of progressBars"
                    class="progress-container"
                  >
                    <label>{{ progressBar.label }}</label>
                    <progress
                      [id]="progressBar.id"
                      [max]="maxValue"
                      [value]="progressBar.value"
                    ></progress>
                    <span class="progress-value">{{ progressBar.value }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
